<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Tracking - Smart Transport Hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tracking-container {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .tracking-header {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
        }
        
        .tracking-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tracking-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .tracking-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .map-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            min-height: 600px;
            position: relative;
            overflow: hidden;
        }
        
        .graph-title {
            font-size: 1.5rem;
            color: #1e293b;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .graph-title i {
            color: #1e40af;
        }
        
        #transportGraph {
            width: 100%;
            height: 500px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .bus-list-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .bus-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bus-card:hover {
            border-color: #1e40af;
            transform: translateX(5px);
        }
        
        .bus-card.active {
            border-color: #1e40af;
            background: rgba(30, 64, 175, 0.05);
        }
        
        .bus-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .bus-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e40af;
        }
        
        .bus-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-moving { background: #d1fae5; color: #065f46; }
        .status-stopped { background: #fef3c7; color: #92400e; }
        .status-delayed { background: #fee2e2; color: #991b1b; }
        
        .bus-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #475569;
        }
        
        .detail-item i {
            color: #1e40af;
            width: 16px;
        }
        
        .bus-progress {
            margin-top: 15px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #475569;
        }
        
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1e40af, #3b82f6);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .controls-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-label {
            font-weight: 600;
            color: #475569;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-label i {
            color: #1e40af;
        }
        
        .control-select {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .control-select:focus {
            outline: none;
            border-color: #1e40af;
        }
        
        .btn-refresh {
            padding: 12px 25px;
            background: #1e40af;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            align-self: flex-end;
        }
        
        .btn-refresh:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
        }
        
        .btn-refresh:active {
            transform: translateY(0);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        
        .stat-title {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: #1e293b;
        }
        
        .stat-change {
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        
        .info-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .algorithm-info {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .algorithm-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }
        
        .algorithm-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .algorithm-list li:last-child {
            border-bottom: none;
        }
        
        .algorithm-list i {
            color: #1e40af;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            stroke-width: 3px;
            stroke: #1e40af;
        }
        
        .link {
            stroke: #94a3b8;
            stroke-width: 2;
        }
        
        .bus-marker {
            animation: pulse 2s infinite;
        }

        .bus-marker-group.active .bus-marker {
            fill: #f59e0b;
        }
        
        @keyframes pulse {
            0% { r: 6; opacity: 1; }
            50% { r: 8; opacity: 0.7; }
            100% { r: 6; opacity: 1; }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1e40af;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Include sidebar and header -->
    <div class="main-content">
        <div class="header">
            <!-- Header content -->
        </div>
        
        <div class="tracking-container">
            <!-- Header -->
            <div class="tracking-header">
                <h1><i class="fas fa-satellite-dish"></i> Live Bus Tracking</h1>
                <p>Real-time tracking with DSA algorithms: Dijkstra, BFS, DFS</p>
            </div>
            
            <!-- Statistics -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">Active Buses</div>
                    <div class="stat-value" id="activeBuses">0</div>
                    <div class="stat-change positive" id="busChange">+0 today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total Passengers</div>
                    <div class="stat-value" id="totalPassengers">0</div>
                    <div class="stat-change positive" id="passengerChange">+0 online</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Avg. Speed</div>
                    <div class="stat-value" id="avgSpeed">0</div>
                    <div class="stat-change">km/h</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">On-time Rate</div>
                    <div class="stat-value" id="onTimeRate">0%</div>
                    <div class="stat-change positive">+2% from yesterday</div>
                </div>
            </div>
            
            <!-- Main Tracking Grid -->
            <div class="tracking-grid">
                <!-- Graph Visualization -->
                <div class="map-container">
                    <h2 class="graph-title">
                        <i class="fas fa-project-diagram"></i> Transport Network Graph
                    </h2>
                    <div id="transportGraph">
                        <!-- D3.js Graph will be rendered here -->
                    </div>
                </div>
                
                <!-- Live Bus List -->
                <div class="bus-list-container">
                    <h2 class="graph-title">
                        <i class="fas fa-bus"></i> Live Buses
                        <span class="bus-count" id="liveBusCount">(0)</span>
                    </h2>
                    
                    <div id="busList">
                        <!-- Bus cards will be loaded here -->
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading live buses...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="controls-container">
                <div class="controls-grid">
                    <div class="control-group">
                        <label class="control-label">
                            <i class="fas fa-filter"></i> Filter by Route
                        </label>
                        <select class="control-select" id="routeFilter">
                            <option value="all">All Routes</option>
                            {% for bus in active_buses %}
                                <option value="{{ bus.route_name }}">{{ bus.route_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            <i class="fas fa-tachometer-alt"></i> Speed Range
                        </label>
                        <select class="control-select" id="speedFilter">
                            <option value="all">All Speeds</option>
                            <option value="slow">Slow (0-30 km/h)</option>
                            <option value="medium">Medium (31-50 km/h)</option>
                            <option value="fast">Fast (51+ km/h)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            <i class="fas fa-map-marker-alt"></i> View Algorithm
                        </label>
                        <select class="control-select" id="algorithmSelect">
                            <option value="dijkstra">Dijkstra's Shortest Path</option>
                            <option value="bfs">BFS - Nearest Stop</option>
                            <option value="dfs">DFS - All Routes</option>
                            <option value="cycle">Cycle Detection</option>
                        </select>
                    </div>
                    
                    <button class="btn-refresh" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
            </div>
            
            <!-- Algorithm Information -->
            <div class="info-container">
                <h2 class="graph-title">
                    <i class="fas fa-code"></i> DSA Algorithms in Action
                </h2>
                
                <div class="algorithm-info">
                    <h3 id="currentAlgorithm">Dijkstra's Algorithm</h3>
                    <p id="algorithmDescription">
                        Finding shortest path between stops using priority queue (min-heap).
                        Time Complexity: O((V+E) log V)
                    </p>
                    
                    <ul class="algorithm-list" id="algorithmSteps">
                        <li><i class="fas fa-check-circle"></i> Initialize distance array with infinity</li>
                        <li><i class="fas fa-check-circle"></i> Use priority queue for efficient extraction</li>
                        <li><i class="fas fa-spinner"></i> Relax edges and update distances</li>
                        <li><i class="fas fa-clock"></i> Track visited nodes to avoid cycles</li>
                    </ul>
                    
                    <div id="algorithmStats" style="margin-top: 15px;">
                        <strong>Current Statistics:</strong>
                        <div>Nodes processed: <span id="nodesProcessed">0</span></div>
                        <div>Edges relaxed: <span id="edgesRelaxed">0</span></div>
                        <div>Execution time: <span id="executionTime">0ms</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let graphData = null;
        let simulation = null;
        let selectedBus = null;
        let autoRefresh = true;
        let liveBusesData = [];
        let graphNodes = [];
        let graphLinks = [];
        let graphNodePositions = new Map();
        let graphSvg = null;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadLiveData();
            setupEventListeners();
            setupAutoRefresh();
            
            // Load graph data
            loadGraphData();
        });
        
        function setupEventListeners() {
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', loadLiveData);
            
            // Filters
            document.getElementById('routeFilter').addEventListener('change', filterBuses);
            document.getElementById('speedFilter').addEventListener('change', filterBuses);
            
            // Algorithm selector
            document.getElementById('algorithmSelect').addEventListener('change', updateAlgorithmInfo);
        }
        
        function setupAutoRefresh() {
            // Auto-refresh every 10 seconds
            setInterval(() => {
                if (autoRefresh) {
                    loadLiveData();
                }
            }, 10000);
        }
        
        function loadLiveData() {
            showLoading(true);
            
            fetch('/api/tracking/live_buses')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        liveBusesData = data.live_buses || [];
                        updateRouteFilterOptions(liveBusesData);
                        applyFilters();
                        updateStats(liveBusesData);
                        updateBusMarkers(liveBusesData);
                        showLoading(false);
                    }
                })
                .catch(error => {
                    console.error('Error loading live data:', error);
                    showLoading(false);
                });
        }
        
        function renderLiveBuses(buses) {
            const container = document.getElementById('busList');
            const count = buses.length;
            
            document.getElementById('liveBusCount').textContent = `(${count})`;
            
            if (count === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 40px;">
                        <i class="fas fa-bus-slash" style="font-size: 3rem; color: #94a3b8;"></i>
                        <p>No active buses found</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            buses.forEach(bus => {
                const totalSegments = bus.total_segments || 1;
                const segmentIndex = bus.segment_index || 0;
                const segmentProgress = bus.segment_progress || 0;
                const overallProgress = Math.min(
                    Math.max(Math.round(((segmentIndex + segmentProgress) / totalSegments) * 100), 0),
                    100
                );
                const speed = bus.speed_kph ?? bus.speed ?? 0;
                
                html += `
                    <div class="bus-card" data-bus="${bus.bus_number}" onclick="selectBusForTracking('${bus.bus_number}')">
                        <div class="bus-header">
                            <div class="bus-number">${bus.bus_number}</div>
                            <div class="bus-status status-${bus.status || 'moving'}">
                                ${bus.status || 'Moving'}
                            </div>
                        </div>
                        
                        <div class="bus-details">
                            <div class="detail-item">
                                <i class="fas fa-route"></i>
                                <span>${bus.route_name}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${bus.current_stop}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-arrow-right"></i>
                                <span>Next: ${bus.next_stop}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-users"></i>
                                <span>${bus.passenger_count}/${bus.capacity}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>${speed} km/h</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-clock"></i>
                                <span>ETA: ${bus.eta}</span>
                            </div>
                        </div>
                        
                        <div class="bus-progress">
                            <div class="progress-label">
                                <span>Segment ${segmentIndex + 1} of ${totalSegments}</span>
                                <span>${overallProgress}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${overallProgress}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updateStats(buses) {
            const activeCount = buses.length;
            const totalPassengers = buses.reduce((sum, bus) => sum + bus.passenger_count, 0);
            const avgSpeed = Math.round(
                buses.reduce((sum, bus) => sum + (bus.speed_kph ?? bus.speed ?? 0), 0) / activeCount
            ) || 0;
            const onTimeRate = Math.floor(Math.random() * 20) + 80; // Random 80-100%
            
            document.getElementById('activeBuses').textContent = activeCount;
            document.getElementById('totalPassengers').textContent = totalPassengers;
            document.getElementById('avgSpeed').textContent = avgSpeed;
            document.getElementById('onTimeRate').textContent = `${onTimeRate}%`;
            
            // Update change indicators
            document.getElementById('busChange').textContent = `+${Math.floor(activeCount * 0.2)} today`;
            document.getElementById('passengerChange').textContent = `+${Math.floor(totalPassengers * 0.1)} online`;
        }
        
        function filterBuses() {
            applyFilters();
        }

        function applyFilters() {
            const routeFilter = document.getElementById('routeFilter').value;
            const speedFilter = document.getElementById('speedFilter').value;
            const filtered = liveBusesData.filter(bus => {
                const matchesRoute = routeFilter === 'all' || (bus.route_name || '') === routeFilter;
                if (!matchesRoute) {
                    return false;
                }
                const speed = bus.speed_kph ?? bus.speed ?? 0;
                if (speedFilter === 'slow') {
                    return speed <= 30;
                }
                if (speedFilter === 'medium') {
                    return speed > 30 && speed <= 50;
                }
                if (speedFilter === 'fast') {
                    return speed > 50;
                }
                return true;
            });
            renderLiveBuses(filtered);
            updateBusMarkers(filtered);
        }

        function updateRouteFilterOptions(buses) {
            const routeFilter = document.getElementById('routeFilter');
            const current = routeFilter.value;
            const routes = Array.from(new Set(buses.map(bus => bus.route_name).filter(Boolean)));
            routeFilter.innerHTML = '<option value="all">All Routes</option>';
            routes.forEach(route => {
                const option = document.createElement('option');
                option.value = route;
                option.textContent = route;
                routeFilter.appendChild(option);
            });
            if (routes.includes(current)) {
                routeFilter.value = current;
            }
        }

        function selectBusForTracking(busNumber) {
            // Remove active class from all buses
            document.querySelectorAll('.bus-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to selected bus
            const selectedCard = document.querySelector(`.bus-card[data-bus="${busNumber}"]`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }
            
            selectedBus = busNumber;
            
            // Highlight bus on graph
            highlightBusOnGraph(busNumber);
        }
        
        function loadGraphData() {
            fetch('/api/passenger/graph')
                .then(response => response.json())
                .then(data => {
                    const stops = data.stops || [];
                    const edges = data.edges || [];
                    graphNodes = stops.map((stop, index) => ({
                        id: stop.name,
                        group: (index % 4) + 1
                    }));
                    graphLinks = edges.map(edge => ({
                        source: edge.from,
                        target: edge.to,
                        value: edge.weight || 1
                    }));
                    renderGraph(graphNodes, graphLinks);
                })
                .catch(error => {
                    console.error('Error loading graph data:', error);
                });
        }
        
        function renderGraph(nodes, links) {
            const width = document.getElementById('transportGraph').clientWidth;
            const height = 500;
            
            d3.select('#transportGraph').selectAll('*').remove();
            
            const svg = d3.select('#transportGraph')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            graphSvg = svg;
            
            // Add links
            const link = svg.append('g')
                .selectAll('line')
                .data(links)
                .enter()
                .append('line')
                .attr('class', 'link')
                .attr('stroke-width', d => Math.sqrt(d.value));
            
            // Add nodes
            const node = svg.append('g')
                .selectAll('circle')
                .data(nodes)
                .enter()
                .append('circle')
                .attr('class', 'node')
                .attr('r', 8)
                .attr('fill', d => {
                    const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
                    return colors[d.group - 1];
                })
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));
            
            // Add labels
            const label = svg.append('g')
                .selectAll('text')
                .data(nodes)
                .enter()
                .append('text')
                .attr('dx', 12)
                .attr('dy', '.35em')
                .text(d => d.id)
                .style('font-size', '12px')
                .style('pointer-events', 'none');
            
            // Add simulation
            simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .on('tick', ticked);
            
            function ticked() {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);
                
                label
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);

                graphNodePositions = new Map(nodes.map(item => [item.id, { x: item.x, y: item.y }]));
                updateBusMarkers(liveBusesData);
            }
            
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
            
        }
        
        function updateBusMarkers(buses) {
            if (!graphSvg) {
                return;
            }
            const markerGroup = graphSvg.selectAll('g.bus-markers')
                .data([null])
                .join('g')
                .attr('class', 'bus-markers');

            const markers = markerGroup.selectAll('g.bus-marker-group')
                .data(buses, d => d.bus_number);

            const markersEnter = markers.enter()
                .append('g')
                .attr('class', 'bus-marker-group');

            markersEnter.append('circle')
                .attr('class', 'bus-marker')
                .attr('r', 6)
                .attr('fill', '#1e40af')
                .attr('stroke', 'white')
                .attr('stroke-width', 2);

            markersEnter.append('text')
                .attr('class', 'bus-marker-label')
                .attr('text-anchor', 'middle')
                .attr('dy', -12)
                .style('font-size', '10px')
                .style('font-weight', 'bold')
                .style('fill', '#1e40af')
                .text(d => `Bus ${d.bus_number}`);

            markers.merge(markersEnter)
                .attr('data-bus', d => d.bus_number)
                .attr('opacity', d => getBusPosition(d) ? 1 : 0);

            markers.exit().remove();

            markerGroup.selectAll('g.bus-marker-group')
                .attr('transform', d => {
                    const position = getBusPosition(d);
                    if (!position) {
                        return 'translate(-999,-999)';
                    }
                    return `translate(${position.x}, ${position.y})`;
                })
                .classed('active', d => String(d.bus_number) === String(selectedBus));
        }

        function getBusPosition(bus) {
            const current = graphNodePositions.get(bus.current_stop);
            const next = graphNodePositions.get(bus.next_stop);
            if (!current || !next) {
                return null;
            }
            const progress = bus.segment_progress ?? 0;
            return {
                x: current.x + (next.x - current.x) * progress,
                y: current.y + (next.y - current.y) * progress
            };
        }
        
        function highlightBusOnGraph(busNumber) {
            updateBusMarkers(liveBusesData);
            
            // Show algorithm visualization
            visualizeShortestPath();
        }
        
        function visualizeShortestPath() {
            const steps = document.getElementById('algorithmSteps');
            const nodes = document.getElementById('nodesProcessed');
            const edges = document.getElementById('edgesRelaxed');
            
            // Simulate algorithm steps
            let step = 0;
            const interval = setInterval(() => {
                if (step < 4) {
                    steps.children[step].querySelector('i').className = 'fas fa-check-circle';
                    step++;
                    
                    // Update stats
                    nodes.textContent = step * 2;
                    edges.textContent = step * 3;
                    document.getElementById('executionTime').textContent = `${step * 50}ms`;
                } else {
                    clearInterval(interval);
                }
            }, 1000);
        }
        
        function updateAlgorithmInfo() {
            const algorithm = document.getElementById('algorithmSelect').value;
            const title = document.getElementById('currentAlgorithm');
            const description = document.getElementById('algorithmDescription');
            
            const algorithms = {
                dijkstra: {
                    title: "Dijkstra's Algorithm",
                    desc: "Finding shortest path between stops using priority queue (min-heap). Time Complexity: O((V+E) log V)"
                },
                bfs: {
                    title: "Breadth-First Search",
                    desc: "Finding nearest bus stop using queue data structure. Time Complexity: O(V+E)"
                },
                dfs: {
                    title: "Depth-First Search",
                    desc: "Exploring all possible routes using stack/recursion. Time Complexity: O(V+E)"
                },
                cycle: {
                    title: "Cycle Detection",
                    desc: "Detecting cycles in transport network using DFS. Time Complexity: O(V+E)"
                }
            };
            
            title.textContent = algorithms[algorithm].title;
            description.textContent = algorithms[algorithm].desc;
        }
        
        function showLoading(show) {
            // You can add loading indicator if needed
            if (show) {
                document.getElementById('refreshBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            } else {
                document.getElementById('refreshBtn').innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
            }
        }
    </script>
</body>
</html>
